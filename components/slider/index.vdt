import Spinner from '../spinner';

const {
    value, min, max, className,
    disabled, isRange, isInnerText,
    isShowInput, isShowEnd, unit,
    step, ref, _isDragging, _isFirst,
    _isSecond, style, ...rest
} = self.get();

const classNameObj = {
    'k-slider': true,
    'k-disabled': disabled,
    [className || '']: true,
    'k-dragging': _isDragging
};

const sliderWidth = max - min;

<div class={{ classNameObj }} style={{ style }}>
    <div class="k-wrapper"  ev-click={{ self.clickWrapper.bind(self) }} ref={{ dom => self.$slider = dom }}>
        <div class="k-bar"
            style={{ isRange ?
                {
                    width: Math.abs(value[1] - value[0]) / sliderWidth * 100 + '%',
                    left: (Math.min(value[0],value[1]) - min) / sliderWidth * 100 + '%'
                } :
                { width: (value - min) / sliderWidth * 100 + '%'}
            }}
        ></div>
        <div class={{ {"k-button-wrapper": true, "k-active": _isFirst && value[1] === self._max || _isSecond && value[0] !== self._min} }}
            style={{ { left: isRange ?  /*(Math.min(value[0], value[1]) - min) / sliderWidth * 100 + '%'*/
                (value[0] - min) / sliderWidth * 100 + '%' :
                (value - min) / sliderWidth * 100 + '%'} }}
            ref={{ dom => self.$sliderFirstBtn = dom }}
            ev-mousedown={{ isRange ? self.onRangeBtn.bind(self, '_isFirst') : self.onRangeBtn.bind(self, undefined)}}>
                <div class="k-button">
                    <div v-if={{ isInnerText }}>{{ isRange ? value : value[0]}}</div>
                </div>
        </div>
        <div class={{ {"k-button-wrapper": true, "k-active": _isSecond && value[0] === self._min || _isFirst && value[1] !== self._max} }}
             v-if={{ isRange }}
             ref={{ dom => self.$sliderSecondBtn = dom }}
             ev-mousedown={{ self.onRangeBtn.bind(self, "_isSecond") }}
             style={{ {left: /*(Math.max(value[0],value[1]) - min)*/ (value[1] - min) / sliderWidth * 100 + '%'} }}
        >
            <div class="k-button">
                <div v-if={{ isInnerText }}>{{ value[1] }}</div>
            </div>
        </div>
        <div class="k-box" v-if={{ isShowEnd }}>
            <span>{{ min + unit }} </span>
            <span>{{ max + unit }}</span>
        </div>
    </div>
    <Spinner
        v-if={{ isShowInput && !isRange }}
        disabled={{ disabled }} 
        max={{ max }} 
        min={{ min }}
        v-model="_inputValue" 
        step={{ step }} 
    />
</div>
